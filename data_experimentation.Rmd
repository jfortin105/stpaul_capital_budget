---
title: "data_experimentation"
author: "Josh Fortin"
date: "2/26/2021"
output: 
  html_document:
    keep_md: TRUE
    toc: TRUE
    df_print: paged
    code_download: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(tidyverse)
library(patchwork)
library(lubridate)
library(gganimate)
library(transformr)
library(gifski)
```

```{r loading data}
Adopted_Capital_Improvement_Budgets <- read_csv("Adopted_Capital_Improvement_Budgets.csv")

Adopted_Capital_Improvement_Budgets %>% 
  mutate(across(where(is.character), as.factor)) %>% 
  summary()
```

```{r}
Adopted_Capital_Improvement_Budgets %>% 
  group_by(YEAR) %>% 
  summarize(year_amount = sum(Amount)) %>% 
  ggplot(aes(x = YEAR, y = year_amount)) +
  geom_col(fill = "darkgreen") +
  scale_y_continuous(labels = scales::comma) +
  labs(title = "Yearly Total Adopted Capital Improvement Budgets",
       subtitle = "2004 - 2021") +
  theme(plot.title.position = "plot")
```


```{r Projects by Service Type}
g1 <- Adopted_Capital_Improvement_Budgets %>% 
  add_count(SERVICE, name = "counts") %>% 
  mutate(s_reorder = fct_reorder(SERVICE, counts, .fun = max)) %>% 
  ggplot(aes(y = s_reorder)) +
  geom_bar() +
  labs(title = "Amount of Projects by Service Type",
       x = "",
       y = "") 

g2 <- Adopted_Capital_Improvement_Budgets %>% 
  mutate(Service_reorder = fct_reorder(SERVICE, Amount, sum)) %>% 
  ggplot(aes(x = Amount, y = Service_reorder)) +
  geom_col() +
  labs(title = "Costs of Projects by Service Type ($)",
       x = "",
       y = "") +
  scale_x_continuous(labels = scales::comma)

service_g <- g2 / g1
service_g
```

```{r projects by department}
g3 <- Adopted_Capital_Improvement_Budgets %>% 
  add_count(DEPARTMENT, name = "counts") %>% 
  mutate(d_reorder = fct_reorder(DEPARTMENT, counts, .fun = max)) %>% 
  ggplot(aes(y = d_reorder)) +
  geom_bar(fill = "darkkhaki") +
  labs(title = "Amount of Projects by Department Type",
       x = "",
       y = "") +
  theme(plot.title.position = "plot",
        plot.background = element_rect("linen"), 
        panel.background = element_rect("linen"),
        legend.background = element_rect("linen"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.x = element_line("grey75"),
        panel.grid.minor.x = element_line("grey80"),
        panel.grid.major.y = element_blank())

g4 <- Adopted_Capital_Improvement_Budgets %>% 
  mutate(department_reorder = fct_reorder(DEPARTMENT, Amount, sum)) %>% 
  ggplot(aes(x = Amount, y = department_reorder)) +
  geom_col(fill = "darkkhaki") +
  labs(title = "Costs of Projects by Department ($)",
       x = "",
       y = "") +
  scale_x_continuous(labels = scales::dollar) +
  theme(plot.title.position = "plot",
        plot.background = element_rect("linen"), 
        panel.background = element_rect("linen"),
        legend.background = element_rect("linen"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.x = element_line("grey75"),
        panel.grid.minor.x = element_line("grey80"),
        panel.grid.major.y = element_blank())

 department_g <- g3 / g4
 department_g
```

```{r}
Adopted_Capital_Improvement_Budgets %>% 
  mutate(department_reorder = fct_reorder(DEPARTMENT, Amount, sum)) %>%
  ggplot(aes(y = department_reorder, x = Amount, fill = SERVICE)) +
  geom_bar(position = "fill", stat = "identity") +
  scale_x_continuous(labels = scales::percent) +
  theme(legend.position = "right",
        legend.direction = "vertical",
        legend.text = element_text(size = 5),
        plot.title.position = "plot") +
  labs(title = "Department Project Amounts by Service Type",
       subtitle = "Percent of Total Project Costs by Each Service Type",
       x = "",
       y = "",
       fill = "")
```
